## Factom时间戳机制如何保护区块链中交易安全

Factom的数据被比特币网络盖上时间戳而变得不可逆转。用户的数据一旦发布到比特币区块链中，就和任何其他比特币交易一样安全。对任何进入Factom系统中的数据的发布进行快速验证是可以实现的。

数据被组织成区块结构，最高等级是经由梅克尔树相结合的目录区块。每10分钟，数据集被冻结，并提交给比特币网络。由于比特币具有不可预测的阻塞时间，每个比特币区块中可能有多于或少于1个Factom时间戳。

Bitcoin的内部头部区块时间也有灵活的时间概念。相对真实时间[可能有2个小时的偏移](https://en.bitcoin.it/wiki/Block_timestamp)。Factom将提供其自己的内部时间戳，遵守标准时间系统。

当联合服务器接收到用户数据请求时，将对其进行分配。Factom将提交条目的引用组织到区块集。Factom的阻塞时间为一分钟。在收盘时，联合服务器网络生成共识，作为区块结构一部分的条目被盖上那一分钟的时间戳。

需要注意的是，该数据在盖上时间戳以前可能已经存在很久。运行在Factom顶层的一个应用程序，可以在条目被记录在Factom之前提供更精细、准确的时间戳服务。Factom时间戳只能确保数据产生的时间不晚于Factom时间戳的时间。

10个目录区块的梅克尔根通过*消费交易*被加入到比特币区块链。*消费*包括[OP_RETURN](http://bitzuma.com/posts/op-return-and-the-future-of-bitcoin/)的输出。我们称此为目录块到比特币区块链的“锚定”。锚定的方法是在给数据盖时间戳的各种方法中对比特币系统损害最小的一个。

*区块链中的OP_RETURN数据的两个可能的替代品被锚定到P2Pool头（如在chronobit）或比特币区块头coinbase。*P2Pool头将需要挖掘几个小时找到一个满足P2Pool规则的块，而其带来的便利不足以弥补其给Factom协议所增加的复杂性。将梅克尔根包括进某一区块coinbase将需要与矿工之间的合作，而这种已经超出了他们之间的交易流程。该coinbase条目仍将需要来自Factom系统的加密签名，因此它相较于签名交易并不能节省多少空间。它不仅不能减少空间，还将被包含在头部优先下载，影响了比特币SPV(Simplified Payment Verification)客户端。

锚的40个可用字节（译注：[OP_RETURN](http://bitzuma.com/posts/op-return-and-the-future-of-bitcoin/)只能传递40个字节的数据。）中的前2个字节将是一个*标志*标签（值为“Fa”）。Factom锚（32字节）被级联到标签，然后该区块的高度被增加（最多可达6个字节，允许约500000年对于1分钟**区块**）。该标志标签表明该交易可以作为一个Factom锚。尽管还需要其它限定条件，但一旦有了标签和Factom块高度，就消除了大部分需要检查的OP_RETURN交易。

OP_RETURN中区块的高度，有助于解决比特币区块记录锚的顺序混乱的那些情况。

锚定数据是一个包含10个单独的目录块的梅克尔根的列表的梅克尔根。*查询Factom DHT的锚定数据将返回的10个目录区块的梅克尔根的列表，这是反过来的DHT为目录区块的密钥。
 Querying the Factom DHT for the anchored data will return the list of 10 Directory Block Merkle roots, which are in turn DHT keys for the Directory Blocks themselves.*


梅克尔根时间戳将由联合服务器中的一个添加到比特币区块链中。这个被委托给联合服务器收集的数据加盖时间戳的服务器创建一个比特币交易。交易将被广播到比特币网络，并被加入一个比特币区块。比特币看起来像一个Factom锚，但不从被称为Factom服务器的地址花费要么是垃圾，或企图叉Factom交易。大多数用户/应用程序会忽略这样的锚。


看起来像一个Factom锚但不由被Factom服务器的地址花费的比特币交易，要么是垃圾要么企图从Factom分岔。大多数用户/应用程序会忽略这样的锚。

比特币区块是通过统计的过程生成的，因此它们的时间无法预测。这意味着，插入比特币区块链及其时间戳机制的OP_RETURN仅能对锚做出粗略的时限。将Factom锚定到比特币的真正价值在于防止任何人生成虚假的Factom历史。由于比特币矿工运气可能不好，或Factom交易纳入系统遭到延迟，Factom状态被冻结10分钟时和锚出现在比特币之间的时间可以变化，甚至可能十分显著。
